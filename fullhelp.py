# file: fullhelp.py

from telegram import Update
from telegram.ext import ContextTypes
import database as db
from constants import (
    SEARCH_COOLDOWN,
    DAILY_BONUS_COOLDOWN,
    RARITY_ORDER,
    COLOR_EMOJIS,
    ITEMS_PER_PAGE,
    ADMIN_USERNAMES,
)

"""–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –∏–∑ –º–æ–¥—É–ª—è constants.py"""


async def fullhelp_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ü–æ–ª–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞ –ø–æ –±–æ—Ç—É: –º–µ—Ö–∞–Ω–∏–∫–∏, –∫–æ–º–∞–Ω–¥—ã, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –º–æ–¥–µ—Ä–∞—Ü–∏—è, –∞–¥–º–∏–Ω-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã."""
    user = update.effective_user
    # –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ –∏ –°–æ–∑–¥–∞—Ç–µ–ª—è
    if not db.is_admin(user.id) and (user.username not in ADMIN_USERNAMES):
        await update.message.reply_text("–ù–µ—Ç –ø—Ä–∞–≤")
        return

    search_minutes = SEARCH_COOLDOWN // 60
    bonus_hours = DAILY_BONUS_COOLDOWN // 3600

    # –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —Å–µ–∫—Ü–∏–∏, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–µ–≤—ã—à–∞—Ç—å –ª–∏–º–∏—Ç—ã –¥–ª–∏–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è
    sections: list[str] = []

    # 1) –û–±—â–µ–µ
    sections.append(
        (
            f"üëã –ü—Ä–∏–≤–µ—Ç, {user.mention_html()}!\n\n"
            "–≠—Ç–æ –ø–æ–¥—Ä–æ–±–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞ –æ –±–æ—Ç–µ –¥–ª—è –∫–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–æ–≤.\n"
            "–ù–∏–∂–µ ‚Äî –∫–∞–∫ –≤—Å—ë —É—Å—Ç—Ä–æ–µ–Ω–æ –∏ –∫–∞–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã –¥–æ—Å—Ç—É–ø–Ω—ã."
        )
    )

    # 2) –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—Å–µ—Ö
    sections.append(
        (
            "<b>–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</b>\n"
            "/start ‚Äî –æ—Ç–∫—Ä—ã—Ç—å –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é.\n"
            "/find ‚Äî –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞ (—Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –≤ –≥—Ä—É–ø–ø–∞—Ö).\n"
            "/leaderboard ‚Äî —Ç–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ –ø–æ —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞–º.\n"
            "/moneyleaderboard ‚Äî —Ç–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ –ø–æ –¥–µ–Ω—å–≥–∞–º.\n"
            "/myreceipts ‚Äî —Å–ø–∏—Å–æ–∫ –≤–∞—à–∏—Ö –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —á–µ–∫–æ–≤ TG Premium.\n"
            "/gift @username ‚Äî –Ω–∞—á–∞—Ç—å –¥–∞—Ä–µ–Ω–∏–µ –Ω–∞–ø–∏—Ç–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫—É (–±–æ—Ç –ø—Ä–∏—à–ª—ë—Ç –≤—ã–±–æ—Ä –≤ –ª–∏—á–∫—É).\n"
            "/help ‚Äî –∫—Ä–∞—Ç–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞.\n"
            "/fullhelp ‚Äî –ø–æ–ª–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞ (—ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ, –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∞–º).\n\n"
            "<b>–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã (–≤–º–µ—Å—Ç–æ /find):</b>\n"
            "‚Ä¢ –ù–∞–ø–∏—à–∏—Ç–µ: \"–ù–∞–π—Ç–∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫\", \"–ù–∞–π–¥–∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫\" –∏–ª–∏ \"–ü–æ–ª—É—á–∏—Ç—å —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫\" ‚Äî —è –ø–æ–π–º—É –∏ –∑–∞–ø—É—â—É –ø–æ–∏—Å–∫.\n"
        )
    )

    # 3) –ò–≥—Ä–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞
    rarity_lines: list[str] = []
    for r in RARITY_ORDER:
        emoji = COLOR_EMOJIS.get(r, '‚ö´')
        rarity_lines.append(f"{emoji} {r}")
    sections.append(
        (
            "<b>–ò–≥—Ä–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞:</b>\n"
            f"‚Ä¢ –ü–æ–∏—Å–∫: —Ä–∞–∑ –≤ {search_minutes} –º–∏–Ω—É—Ç.\n"
            f"‚Ä¢ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å: —Ä–∞–∑ –≤ {bonus_hours} —á–∞—Å–æ–≤.\n"
            "‚Ä¢ –†–µ–¥–∫–æ—Å—Ç–∏ –Ω–∞–ø–∏—Ç–∫–æ–≤ (–æ—Ç –æ—Å–æ–±—ã—Ö –∫ –±–∞–∑–æ–≤—ã–º):\n"
            + "\n".join(f"  ‚Äî {line}" for line in rarity_lines) + "\n"
            "‚Ä¢ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞–ø–∏—Ç–∫–æ–≤ –±–µ—Ä—É—Ç—Å—è –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ energy_images/."
        )
    )

    # 4) –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
    sections.append(
        (
            "<b>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å:</b>\n"
            f"‚Ä¢ –ü–∞–≥–∏–Ω–∞—Ü–∏—è: –ø–æ {ITEMS_PER_PAGE} –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É.\n"
            "‚Ä¢ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –ø–æ —Ä–µ–¥–∫–æ—Å—Ç–∏ –∏ –Ω–∞–∑–≤–∞–Ω–∏—é.\n"
            "‚Ä¢ –ú–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –ø—Ä–µ–¥–º–µ—Ç–∞ –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥ –∫–Ω–æ–ø–∫–æ–π."
        )
    )

    # 5) –î–∞—Ä–µ–Ω–∏–µ
    sections.append(
        (
            "<b>–î–∞—Ä–µ–Ω–∏–µ –Ω–∞–ø–∏—Ç–∫–æ–≤:</b>\n"
            "‚Ä¢ –í –≥—Ä—É–ø–ø–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ: /gift @username ‚Äî –±–æ—Ç –ø—Ä–∏—à–ª—ë—Ç –≤—ã–±–æ—Ä –ø—Ä–µ–¥–º–µ—Ç–∞ –≤ –ª–∏—á–∫—É.\n"
            "‚Ä¢ –ü–æ–ª—É—á–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç/–æ—Ç–∫–ª–æ–Ω—è–µ—Ç –ø–æ–¥–∞—Ä–æ–∫ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏."
        )
    )

    # 6) –ù–∞—Å—Ç—Ä–æ–π–∫–∏
    sections.append(
        (
            "<b>–ù–∞—Å—Ç—Ä–æ–π–∫–∏:</b>\n"
            "‚Ä¢ –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (RU/EN).\n"
            "‚Ä¢ –ê–≤—Ç–æ–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∫—É–ª–¥–∞—É–Ω–∞ –ø–æ–∏—Å–∫–∞.\n"
            "‚Ä¢ –°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ: —É–¥–∞–ª—è–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å)."
        )
    )

    # 7) –ì—Ä—É–ø–ø—ã –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    sections.append(
        (
            "<b>–ì—Ä—É–ø–ø—ã –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:</b>\n"
            "‚Ä¢ –ë–æ—Ç —Ç–∏—Ö–æ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –≥—Ä—É–ø–ø—É –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏.\n"
            "‚Ä¢ –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤ –≥—Ä—É–ø–ø—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∏–º–µ—Ä–Ω–æ —Ä–∞–∑ –≤ 4 —á–∞—Å–∞."
        )
    )

    # 8) –ó–∞—è–≤–∫–∏ –∏ –º–æ–¥–µ—Ä–∞—Ü–∏—è
    sections.append(
        (
            "<b>–ó–∞—è–≤–∫–∏ –∏ –º–æ–¥–µ—Ä–∞—Ü–∏—è:</b>\n"
            "‚Ä¢ /add ‚Äî –¥–∏–∞–ª–æ–≥–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–ø–∏—Ç–∫–∞ (–Ω–∞–∑–≤–∞–Ω–∏–µ ‚Üí –æ–ø–∏—Å–∞–Ω–∏–µ ‚Üí —Å–ø–µ—Ü? ‚Üí —Ñ–æ—Ç–æ/skip).\n"
            "‚Ä¢ /editdrink &lt;drink_id&gt; &lt;name|description&gt; &lt;new_value&gt; ‚Äî –∑–∞—è–≤–∫–∞ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–∞–¥–º–∏–Ω—ã —É—Ä.1+, —Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–∫–µ).\n"
            "‚Ä¢ /requests ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—è–≤–æ–∫ (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ) —Å –∫–Ω–æ–ø–∫–∞–º–∏ –æ–¥–æ–±—Ä–µ–Ω–∏—è/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è (–¥–ª—è –∞–¥–º–∏–Ω–æ–≤).\n"
            "‚Ä¢ /delrequest &lt;drink_id&gt; [reason] ‚Äî –∑–∞—è–≤–∫–∞ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–∞–ø–∏—Ç–∫–∞ (–¥–ª—è –∞–¥–º–∏–Ω–æ–≤)."
        )
    )

    # 9) –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ (–∫—Ä–∞—Ç–∫–æ)
    sections.append(
        (
            "<b>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ:</b>\n"
            "‚Ä¢ –†–æ–ª–∏: –æ–±—ã—á–Ω—ã–µ –∞–¥–º–∏–Ω—ã (—É—Ä.1-2) –∏ –ì–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω (—É—Ä.3); –°–æ–∑–¥–∞—Ç–µ–ª—å ‚Äî –æ—Å–æ–±–∞—è —Ä–æ–ª—å.\n"
            "‚Ä¢ /admin add|remove|level ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–æ–≤.\n"
            "‚Ä¢ /id ‚Äî —Å–ø–∏—Å–æ–∫ ID –Ω–∞–ø–∏—Ç–∫–æ–≤ (—Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–∫–µ).\n"
            "‚Ä¢ /incadd ‚Äî —Å–æ–∑–¥–∞—Ç—å –æ–±—ã—á–Ω—É—é –∑–∞—è–≤–∫—É –æ—Ç –∏–º–µ–Ω–∏ –°–æ–∑–¥–∞—Ç–µ–ª—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏."
            "‚Ä¢ /inceditdrink ‚Äî —Å–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç –∏–º–µ–Ω–∏ –°–æ–∑–¥–∞—Ç–µ–ª—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏."
            "‚Ä¢ /incdelrequest ‚Äî —Å–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ –æ—Ç –∏–º–µ–Ω–∏ –°–æ–∑–¥–∞—Ç–µ–ª—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏."
        )
    )

    # 10) –î–∞–Ω–Ω—ã–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
    sections.append(
        (
            "<b>–î–∞–Ω–Ω—ã–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:</b>\n"
            "‚Ä¢ –ü—Ä–æ–≥—Ä–µ—Å—Å –∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.\n"
            "‚Ä¢ –ù–∏–∫–∞–∫–∏–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è (–∫—Ä–æ–º–µ –Ω–∏–∫–Ω–µ–π–º–æ–≤ –≤ —Ç–∞–±–ª–∏—Ü–µ –ª–∏–¥–µ—Ä–æ–≤)."
        )
    )

    for part in sections:
        try:
            await update.message.reply_html(part, disable_web_page_preview=True)
        except Exception:
            # –ù–∞ —Å–ª—É—á–∞–π —Ä–µ–¥–∫–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π ‚Äî –ø—Ä–æ–±—É–µ–º –ø—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç
            await update.message.reply_text(part, disable_web_page_preview=True)
